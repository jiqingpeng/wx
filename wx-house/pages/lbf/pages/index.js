"use strict";var _index=require("../actions/index"),_index2=require("../util/index"),_lbf=require("../lbf.project");function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}Page({data:{sysInfo:{},isInit:!0,tabs:_lbf.project.tabs.length?_lbf.project.tabs:["活动","收益"],tabWidth:70,currentTab:0,offset:0,swiperHeight:"",navbarStatus:!1,jump:!1,extra:new Map([[0,2],[1,3],[2,4]])},onLoad:function(t){var e=this;if(wx.getStorageSync(_index.storageKeys.team_page_status)&&this.setData({tabs:[].concat(_toConsumableArray(this.data.tabs),["团队"])}),t.url){wx.showLoading({title:"加载中",mask:!0}),this.setData({jump:!0});var a=t.url,n=t.app_id;t.user_id;(0,_index2.count)({type:10,app_id:n,user_id:""}),wx.redirectTo({url:a})}else{var r=t.tab||0;this.setData({currentTab:r},function(){return e.setOffset()});var s=wx.getStorageSync(_index.storageKeys.title)||"裂变坊";wx.setNavigationBarTitle({title:s}),(0,_index2.getSystemInfo)().then(function(t){e.setData({sysInfo:t,swiperHeight:t.windowHeight-40})})}},onUnload:function(){wx.hideNavigationBarLoading()},onPullDownRefresh:function(){switch(this.data.currentTab){case 0:wx.stopPullDownRefresh();break;case 1:this.selectComponent("#income").initData();break;case 2:this.selectComponent("#team").getRankData(!0)}},onShareAppMessage:function(t){var e=this;try{var a=wx.getStorageSync(_index.storageKeys.user),n=wx.getStorageSync(_index.storageKeys.share_path),r=wx.getStorageSync(_index.storageKeys.remind_path),s=wx.getStorageSync(_index.storageKeys.forward_card),i=wx.getStorageSync(_index.storageKeys.reminder_card),o=wx.getStorageSync(_index.storageKeys.id),c=a.nickname,u=o.user_id,d=o.app_id,p=t.target,l=p.dataset,g=p.id,f=l.msg,h=l.shareType||"normal",_="",m="",y="",x=2;switch(h){case"remind":_=""+c+(i.description||"提醒你，你的优惠券还未使用，再不使用就要过期啦"),m=i.img_url||"",y="/pages/lbf/pages/index?app_id="+d+"&user_id="+u+"&url="+r,x=9;break;default:_=""+c+(s.description||"送给你一张优惠券，立即领取即可享受专属优惠"),m=s.img_url||"",y=n,x=2}return{title:_,imageUrl:m,path:y,fail:function(){console.error("转发失败:",{nickname:c,user_id:u,forwardType:h})},complete:function(){(0,_index2.count)({type:x,app_id:d,user_id:u}),Object.is(h,"remind")&&e.selectComponent("#income").remind(g,f)}}}catch(t){console.error(t)}},changeTab:function(t){var e=this,a=t.currentTarget,n=a.id,r=(a.offsetLeft,+n);Object.is(this.data.currentTab,r)||this.setData({currentTab:r},function(){e.resetComponentStatus(r),e.resetStyle(),e.countUV(r)})},swiperTab:function(t){var e=this,a=t.detail,n=a.source,r=a.current;Object.is(n,"touch")&&this.setData({currentTab:r},function(){e.resetStyle(),e.resetComponentStatus(r),e.countUV(r)})},updateTab:function(t){var a=this,n=t.detail.currentTab;this.setData({currentTab:n},function(){a.resetStyle();var t=a.selectComponent("#share");t&&t.startBreathe(!0);var e=a.selectComponent("#income");e&&e.updateTip({}),a.countUV(n)})},resetStyle:function(){this.toTop(),this.setOffset()},resetComponentStatus:function(t){var e=this.selectComponent("#share");e&&(e.startBreathe(!1),e.updatePosterStatus(!1));var a=this.selectComponent("#income");a&&(a.updateTipStatus({}),a.updatePosterStatus(!1));var n=this.selectComponent("#team");n&&n.updateTipStatus({})},updateNavbarStatus:function(t){this.setData({navbarStatus:t.detail.status||!1})},toTop:function(){wx.pageScrollTo({scrollTop:0,duration:0})},setOffset:function(){var a=this;wx.createSelectorQuery().select(".ping-active").boundingClientRect(function(t){var e=t.left;a.setData({offset:e,isInit:!1})}).exec()},countUV:function(t){var e=new Map([[0,2],[1,3],[2,4]]);this.count({type:0,extra:e.get(t)})},count:function(t){var e=wx.getStorageSync(_index.storageKeys.id),a=e.app_id,n=e.user_id;(0,_index2.count)(Object.assign({app_id:a,user_id:n},t))}});